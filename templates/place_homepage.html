{% extends 'base.html' %}

{% block content %}
<h1>QR gerneration</h1>

<form class="generate-buttons" action="{{ url_for('downloadQR')}}">
    <button class="mainButton">GENERATE</button>
</form>
<form class="generate-buttons" action="{{ url_for('placeLogout')}}">
    <button class="mainButton">Logout</button>
</form>
<button onclick="downloadSvg()">Download QR Code</button>
    


<div class="qr-image">

    <img src="{{ qr }}" alt="">
</div>

<script>
    function downloadSvg() {


        var svg = document.querySelector('svg');
        var canvas = document.querySelector('canvas');

        function triggerDownload(imgURI) {
            var evt = new MouseEvent('click', {
                view: window,
                bubbles: false,
                cancelable: true
            });

            var a = document.createElement('a');
            a.setAttribute('download', 'qr.jpg');
            a.setAttribute('href', imgURI);
            a.setAttribute('target', '_blank');

            a.dispatchEvent(evt);
        }

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var data = (new XMLSerializer()).serializeToString(svg);
        var DOMURL = window.URL || window.webkitURL || window;

        var img = new Image();
        var svgBlob = new Blob([data], {
            type: 'image/svg+xml;charset=utf-8'
        });
        var url = DOMURL.createObjectURL(svgBlob);

        img.onload = function () {
            ctx.drawImage(img, 0, 0, 100, 100);
            DOMURL.revokeObjectURL(url);

            var imgURI = canvas
                .toDataURL('image/jpg')
                .replace('image/jpg', 'image/octet-stream');

            triggerDownload(imgURI);
        };
        img.src = url;
    }
</script>

{% endblock %}

{% block impressum%} {% endblock %}